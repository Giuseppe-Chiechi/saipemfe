@inherits SaipemE_PTW.Components.Base.CommonComponentBase




<MudText Typo="Typo.h6" Align="Align.Center" Class="mb-4 " Style="background-color:#efe3d5">
    Certificati isolamento fonti energetiche collegati
</MudText>

<MudButtonGroup Color="Color.Secondary" Variant="Variant.Filled">

    <MudTooltip Text="Cerca Certificati Esistenti" Style="width:auto">
        <MudIconButton OnClick="ApriDialogCollega" Icon="@Icons.Material.Filled.Search" />
    </MudTooltip>

    <MudTooltip Text="Crea Certificato" Style="width:auto">
        <MudIconButton OnClick="ApriDialogCrea" Icon="@Icons.Material.Filled.Add" />
    </MudTooltip>
</MudButtonGroup>




<MudTable Items="@moduliElettrici" Dense Class="mb-4 mt-4" Style="90%">
    <HeaderContent>
        <MudTh Style="background-color:#f7f2ec">Tipo</MudTh>
        <MudTh Style="background-color:#f7f2ec">Certificato numero</MudTh>
        <MudTh Style="background-color:#f7f2ec; width:100px"></MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd>
           Isolamento Fonti Energetiche
          
        </MudTd>
        <MudTd>
           @context
        </MudTd>
        <MudTd>

            <MudButtonGroup Variant="Variant.Filled">
                <MudTooltip Text="Dettaglio">
                    <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.ContentPasteSearch" Color="Color.Secondary" OnClick="@(() => NavigateToDetail(123))" />
                </MudTooltip>

                <MudTooltip Text="Elimina">
                    <MudIconButton Size="Size.Small" Icon="@Icons.Material.Filled.Close" Color="Color.Error" OnClick="@(() => RimuoviModulo(context))" />
                </MudTooltip>
                

            </MudButtonGroup>

        </MudTd>
    </RowTemplate>
</MudTable>




@code {
    [Parameter] public PermessoLavoroModel Model { get; set; } = new PermessoLavoroModel();
    [Parameter] public EventCallback<PermessoLavoroModel> ModelChanged { get; set; }
    
    private List<string> moduliElettrici = new();

    private async Task ApriDialogCollega()
    {
        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Large, FullWidth = true };

        var parameters = new DialogParameters
        {

        };
        var dialog = await DialogService.ShowAsync<SearchDialog>(
                 "Seleziona Certificato",
                 parameters,
                 options
             );

        //var dialog = DialogService.Show<CertificatoIsolamentoEnergeticoSearchDialog>("Seleziona Modulo", options);
        var result = await dialog.Result;

        if (result != null && !result.Canceled && result.Data is string modulo)
        {
            moduliElettrici.Add(modulo);
        }
    }

    private async Task ApriDialogCrea()
    {
        var parameters = new DialogParameters
        {
            { "Messaggio", "Vuoi creare un nuovo Certificato di Isolamento Fonti Energetiche?" }
        };

        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Large, FullWidth = true };


        var dialog = await DialogService.ShowAsync<AddDialog>(
                 "Conferma creazione",
                 parameters,
                 options
             );

        //var dialog = DialogService.Show<CertificatoIsolamentoEnergeticoConfermaDialog>("Conferma creazione", parameters, options);
        var result = await dialog.Result;

        if (result != null && !result.Canceled)
        {
            var nuovoModulo = $"MOD.ELETT.RM.LIV.2025.{(moduliElettrici.Count + 1):D5}";
            moduliElettrici.Add(nuovoModulo);
        }
    }

    private void RimuoviModulo(string modulo)
    {
        moduliElettrici.Remove(modulo);
    }

    void NavigateToDetail(int idCertificato)
    {
        Navigation.NavigateTo($"/workflow/certificate/energy-source-isolation/detail/{Model.id}/{idCertificato}");
    }
}

