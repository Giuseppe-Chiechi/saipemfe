@inject IDialogService DialogService


<MudText Typo="Typo.h6" Align="Align.Center" Class="mb-4 " Style="background-color:#efe3d5">
    Certificati isolamento fonti energetiche collegati
    </MudText>

        <MudButtonGroup Color="Color.Secondary" Variant="Variant.Filled">

     <MudTooltip Text="Cerca Certificati Esistenti" Style="width:auto">
        <MudIconButton OnClick="ApriDialogCollega"  Icon="@Icons.Material.Filled.Search" />
    </MudTooltip>

            <MudTooltip Text="Crea Certificato" Style="width:auto">
        <MudIconButton OnClick="ApriDialogCrea" Icon="@Icons.Material.Filled.Add" />
    </MudTooltip>
</MudButtonGroup>


 

<MudTable Items="@moduliElettrici" Dense Class="mb-4 mt-4" Style="90%">
        <HeaderContent>
        <MudTh Style="background-color:#f7f2ec">Numero Modulo Elettrico</MudTh>
        <MudTh Style="background-color:#f7f2ec; width:15%">Rimuovi</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>
                <MudLink Href="#">@context</MudLink>
            </MudTd>
            <MudTd>
                <MudIconButton Icon="@Icons.Material.Filled.Close" Color="Color.Error" OnClick="@(() => RimuoviModulo(context))" />
            </MudTd>
        </RowTemplate>
    </MudTable>




@code {
    private List<string> moduliElettrici = new();

    private async Task ApriDialogCollega()
    {
        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Large, FullWidth = true };
        
        var parameters = new DialogParameters
        {
            
        };
        var dialog = await DialogService.ShowAsync<CertificatoIsolamentoEnergeticoSearchDialog>(
                 "Seleziona Certificato",
                 parameters,
                 options
             );
        
        //var dialog = DialogService.Show<CertificatoIsolamentoEnergeticoSearchDialog>("Seleziona Modulo", options);
        var result = await dialog.Result;

        if (result != null &&  !result.Canceled && result.Data is string modulo)
        {
            moduliElettrici.Add(modulo);
        }
    }

    private async Task ApriDialogCrea()
    {
        var parameters = new DialogParameters
        {
            { "Messaggio", "Vuoi creare un nuovo modulo elettrico collegato?" }
        };

        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Large, FullWidth = true };

       
        var dialog = await DialogService.ShowAsync<CertificatoIsolamentoEnergeticoConfermaDialog>(
                 "Conferma creazione",
                 parameters,
                 options
             );

        //var dialog = DialogService.Show<CertificatoIsolamentoEnergeticoConfermaDialog>("Conferma creazione", parameters, options);
        var result = await dialog.Result;

        if (result != null && !result.Canceled)
        {
            var nuovoModulo = $"MOD.ELETT.RM.LIV.2025.{(moduliElettrici.Count + 1):D5}";
            moduliElettrici.Add(nuovoModulo);
        }
    }

    private void RimuoviModulo(string modulo)
    {
        moduliElettrici.Remove(modulo);
    }
}

        