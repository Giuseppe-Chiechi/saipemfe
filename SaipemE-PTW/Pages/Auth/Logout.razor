@page "/logout"
@inherits SaipemE_PTW.Components.Base.CommonComponentBase
@attribute [AllowAnonymous]
@inject IAuthService Auth
@inject NavigationManager Nav
@inject AuthenticationStateProvider AuthProvider

<!-- Data: 2025-10-20 - Pagina Logout mock OIDC -->
<MudContainer MaxWidth="MaxWidth.Small" Class="mt-10">
    <MudPaper Class="p-6" Elevation="2">
        <MudText Typo="Typo.h6" Class="text-blu">Disconnessione in corso...</MudText>
    </MudPaper>
</MudContainer>

@code {
    protected override async Task OnInitializedCoreAsync()
    {
        try
        {
            StateHasChanged();
            await Auth.SignOutAsync();
            // Data: 2025-10-20 - Notifica al provider per aggiornare AuthenticationState
            // if (AuthProvider is SaipemE_PTW.Services.Auth.CustomAuthStateProvider p)
            //     p.NotifyAuthenticationStateChangedSafe();

            
            Nav.NavigateTo("/login");
        }
        catch (Exception ex)
        {
            Logger.Error(ex, ex.Message);
        }
    }
}
